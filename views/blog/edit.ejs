<%- include('../partials/header') %>
<main class="container" style="padding:2rem 0;">
  <h1>コラム編集</h1>

  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

  <form action="/admin/posts/<%= post._id %>?key=<%= key %>" method="POST" onsubmit="return submitQuill();">
    <input type="hidden" name="_method" value="PUT">

    <label>タイトル</label>
    <input type="text" name="title" value="<%- post.title %>" required>

    <label>カテゴリ</label>
    <input type="text" name="category" value="<%- post.category %>">

    <label>本文</label>
    <div id="editor" style="height:360px;"></div>
    <textarea name="bodyHtml" id="bodyHtml" hidden required></textarea>

    <label style="display:block;margin-top:10px;">
      <input type="checkbox" name="published" <%= post.published ? 'checked' : '' %>> 公開する
    </label>

    <button type="submit">更新</button>
    <a href="/admin/posts?key=<%= key %>">戻る</a>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
  <script>
    const quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: '本文を編集…',
      modules: {
        toolbar: [
          [{ header: [1, 2, 3, false] }],
          ['bold','italic','underline','strike'],
          [{ list:'ordered' }, { list:'bullet' }],
          ['blockquote','code-block','link'],
          ['clean']
        ]
      }
    });
    const initialHtml = `<%- post.body %>`;
    quill.root.innerHTML = initialHtml;

    function submitQuill() {
      document.getElementById('bodyHtml').value = quill.root.innerHTML;
      return quill.getText().trim().length > 0;
    }
  </script>
</main>
<%- include('../partials/footer') %>